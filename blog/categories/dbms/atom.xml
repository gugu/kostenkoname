<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: DBMS | Андрей Костенко]]></title>
  <link href="http://gugu.github.com/kostenkoname/blog/categories/dbms/atom.xml" rel="self"/>
  <link href="http://gugu.github.com/kostenkoname/"/>
  <updated>2014-01-29T13:34:46+04:00</updated>
  <id>http://gugu.github.com/kostenkoname/</id>
  <author>
    <name><![CDATA[Andrii Kostenko]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Пример регрессионного теста в MySQL]]></title>
    <link href="http://gugu.github.com/kostenkoname/blog/2009/01/05/regression-test-sample-mysql/"/>
    <updated>2009-01-05T19:35:44+03:00</updated>
    <id>http://gugu.github.com/kostenkoname/blog/2009/01/05/regression-test-sample-mysql</id>
    <content type="html"><![CDATA[<pre><code>DROP TABLE IF EXISTS expected_values, found_values;
CREATE TABLE expected_values (
    table_name varchar(30) not null primary key,
    recs int not null,
    crc_sha varchar(100) not null,
    crc_md5 varchar(100) not null
) ENGINE=MyISAM;
CREATE TABLE found_values LIKE expected_values;

INSERT INTO `expected_values` VALUES ('employees',   300024,'4d4aa689914d8fd41db7e45c2168e7dcb9697359', '4ec56ab5ba37218d187cf6ab09ce1aa1'),
('departments',      9,'4b315afa0e35ca6649df897b958345bcb3d2b764', 'd1af5e170d2d1591d776d5638d71fc5f'),
('dept_manager',    24,'9687a7d6f93ca8847388a42a6d8d93982a841c6c', '8720e2f0853ac9096b689c14664f847e'),
('dept_emp',    331603,'f16f6ce609d032d6b1b34748421e9195c5083da8',  'c2c4fc7f0506e50959a6c67ad55cac31'),
('titles',      443308,'d12d5f746b88f07e69b9e36675b6067abb01b60e', 'bfa016c472df68e70a03facafa1bc0a8'),
('salaries',   2844047,'b5a1785c27d75e33a4173aaa22ccf41ebd7d4a9f', 'fd220654e95aea1b169624ffe3fca934');
SELECT table_name, recs AS expected_records, crc_sha AS expected_crc FROM expected_values;
SET @crc= '';

INSERT INTO tchecksum 
    SELECT @crc := sha(CONCAT_WS('#',@crc,
                emp_no,birth_date,first_name,last_name,gender,hire_date)) 
    FROM employees ORDER BY emp_no;
INSERT INTO found_values VALUES ('employees', (SELECT COUNT(*) FROM employees), @crc,@crc);
TRUNCATE tchecksum; -- if BlackHole is not available

SELECT  
    e.table_name, 
    IF(e.recs=f.recs,'OK', 'not ok') AS records_match, 
    IF(e.crc_sha=f.crc_sha,'ok','not ok') AS crc_match 
from 
    expected_values e INNER JOIN found_values f USING (table_name); 

DROP TABLE expected_values,found_values;
</code></pre>
]]></content>
  </entry>
  
</feed>
