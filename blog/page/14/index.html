
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Андрей Костенко</title>
  <meta name="author" content="Andrii Kostenko">

  
  <meta name="description" content="Иногда нам приходится собирать приложения из исходников. Причин для этого море - старая версия в репозитории, это приложение в репозиторий не попало &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://gugu.github.com/kostenkoname/blog/page/14/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Андрей Костенко" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-6026113-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Андрей Костенко</a></h1>
  
    <h2>TODO: добавить умный комментарий</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:gugu.github.com/kostenkoname" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/17/source-code-management/">Source Code Management</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-17T18:21:29+03:00" pubdate data-updated="true">Nov 17<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Иногда нам приходится собирать приложения из исходников. Причин для этого море - старая версия в репозитории, это приложение в репозиторий не попало, или нам нужно его пропатчить. Не важно&#8230;</p>

<p>У сборки из исходников есть один очевидный минус - удалить приложение практически нереально. В некоторых мы можем написать <code>make uninstall</code>, но таких приложений не так уж много.</p>

<p>В linux для этого существует утилита checkinstall &#8211; она создаёт пакет из архива с исходниками, который корректно ставится и удаляется. И работает она очень просто:</p>

<pre><code>    sudo apt-get install checkinstall
    ./configure
    make
    sudo checkinstall -D #создать deb-пакет
    # или sudo checkinstall -R (RPM)
    # sudo checkinstall -S (Slackware)
</code></pre>

<p>После чего он порадует вас сообщением:</p>

<pre><code>**********************************************************************
 Done. The new package has been installed and saved to
 /home/gugu/doodb/tokyotyrant-1.1.34/tokyotyrant_1.1.34-1_amd64.deb
 You can remove it from your system anytime using:
      dpkg -r tokyotyrant
**********************************************************************
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/13/optimization/">Это двадцатый пост с названием &#8220;Заебали&#8221;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-13T00:31:27+03:00" pubdate data-updated="true">Nov 13<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Постоянно от программистов слышу жуткую заботу о производительности приложений. Поэтому я попросил Капитана Очевидность прояснить ситуацию:</p>

<p> &#8211; Капитан, что вы думаете об оптимизации производительности?
 &#8211; Я, как и все адекватные личности не думаю о ней без надобности. Ещё я терпеть не могу биомассу, которая занимается преждевременной оптимизацией. О ней нужно думать лишь тогда, когда всё действительно уж хреново. Как правило, программисты обычно пишут проект немытыми руками, вследствие чего он начинает тормозить. Потом они на этот проект навешивают пять уровней кэширования, надеясь, что это загладит их проёб. Постараюсь привести интересную цитату профессора из MIT (спасибо, vovkasm-у):</p>

<blockquote><p>Here is the list of things more important than performance:</p>

<ul>
<li><p>modularity,</p></li>
<li><p>correctness,</p></li>
<li><p>maintainability,</p></li>
<li><p>security,</p></li>
<li><p>functionality,</p></li>
<li><p>robustness,</p></li>
<li><p>user-friendliness,</p></li>
<li><p>programmer’s time,</p></li>
<li><p>simplicity,</p></li>
<li><p>extensibility,</p></li>
<li><p>reliability, and</p></li>
<li><p>scalability.</p></li>
</ul>
</blockquote>

<p>Этот, сука, умный дядя говорит «не страдайте хуйнёй». Пишите максимально хороший код и вы забудете про оптимизацию.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/12/bootstrap/">Bootstrap. Социальное.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-12T01:31:31+03:00" pubdate data-updated="true">Nov 12<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Наше общество сейчас напоминает очень бажный проект, который наступал сотни раз на грабли, и имеет огромное количество шрамов. Этот проект создавался сотнями различных людей. От Иисуса и древних правителей до Сталина и Гитлера. Сейчас оно забито <em>хреноткудавзявшимися</em> стереотипами, идеалами, поведением.</p>

<p>А что если попробовать создать общество совершенно с нуля? Взять два-три десятка тысяч  новорождённых, воспитывать их специально обученными людьми, которые не должны проявлять своих эмоций. Они должны обучить детей сухим фактам: физике, математике, химии, биологии, медицине итд&#8230; Но не истории. Нужно сделать так, чтобы они вообще не знали о существующем обществе. Чтобы они не знали, что есть «правильно», а что &#8211; «ошибочно».
Отвести для них обособленное поселение, дать всё необходимое для начала жизни&#8230;. и&#8230; прекратить с ними какие-либо контакты.</p>

<p>И посмотреть, к какому социальному-политическому строю они придут. Какое вообще у них будет общество. Главная проблема древних людей - они вообще не знали, как работает всё вокруг. Новые люди - будут знать. Но у них не будет того исторического наследия, которое сейчас руководит нами. В этом случае может получиться что-то совершенно новое, гениальное.</p>

<p>К сожалению, это просто теория, которая никогда не станет реальностью. Догадываетесь, почему?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/08/d0b7d0b2d0bed0bdd0b8d0bb-d0b4d0bed0bcd0bed0b9/">Звонил домой</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-08T20:56:57+03:00" pubdate data-updated="true">Nov 8<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Мама, работая в поликлинике, тоже не понимает, какого чёрта карантин ввели. Никакой эпидемии и близко нет. Стандартное количество заболевших для ноября. И все - ОРВИ.</p>

<p>Если эпидемия в Западной Украине - так пусть пограничников из Харьковской и Луганской области переведут в Тернопольскую область.</p>

<p>Так что карантин &#8211; это личная инициатива нашего презика.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/05/accept-filters/">Ускоряем свой HTTP-сервер</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-05T22:17:38+03:00" pubdate data-updated="true">Nov 5<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Для начала расскажу, как обычно работают сервера:</p>

<ol>
<li><p>Создаётся сокет, который слушает порт</p></li>
<li><p>Вызывается системный вызов accept, который берёт первого клиента из очереди соединений, а если его нет - то блокирует приложение до тех пор, пока он не появится</p></li>
<li><p>Приложение что-то делает с этим клиентом и в конце концов с ним прощается</p></li>
<li><p>goto пункт два</p></li>
</ol>


<p>nginx и lighttpd использует вместо accept функции select/kevent/epoll, которые позволяют работать со многими клиентами одновременно, но это уже отдельная история (к асинхронным веб-серверам accept-фильтры применимяются точно так же)</p>

<p>Accept-фильтры - это модули ядра FreeBSD, которые не говорят, что сокет готов до тех пор, пока не выполнится какое-то условие. Я нашёл только два фильтра:</p>

<ul>
<li><p><strong>dataready</strong> - accept блокирует сокет до тех пор, пока в него прийдут данные. Когда мы получаем сокет, мы уже точно можем из него что-то считать</p></li>
<li><p><strong>httpready</strong> - сокет блокируется до тех пор, пока не прийдёт полный GET/HEAD запрос. Соответственно, нам не надо тратить время на переключение контекста, если запрос ещё не собрался.</p></li>
</ul>


<h3>Остановимся на фильтре httpready</h3>

<p>Буферизирует он только GET и HEAD запросы, так как в POST/PUT может прийти 600мегабайтный <a href="http://mirrors.kernel.org/gentoo/releases/amd64/autobuilds/current-iso/install-amd64-minimal-20091029.iso">порнофильм</a>.
Итак, подключаем модуль accf_http:</p>

<pre><code>    kldload accf_http
    echo 'accf_http_load=”YES”' &gt;&gt; /boot/loader.conf
</code></pre>

<p>Далее нужно изменить работу с сокетом &#8211; установить опцию httpready:</p>

<pre><code>        struct accept_filter_arg afa;
        bzero(&amp;afa;, sizeof(afa));
        strcpy(afa.af_name, "httpready");
        setsockopt(sok, SOL_SOCKET, SO_ACCEPTFILTER, &amp;afa;, sizeof(afa)); 
</code></pre>

<h3>Результаты тестов</h3>

<p>Так как существует мнение, что accept-фильтры бесполезны, мы решили провести тестирование. Веб-сервер был выбран AnyEvent::HTTPD, клиент - ab. Итак, результаты:</p>

<ol>
<li><p>локальная машина, 10000 запросов, concurrency = 4: httpready даёт прирост в 10%</p></li>
<li><p>локальная сеть, 10000 запросов, concurrency=1000: httpready даёт прирост в 10%</p></li>
<li><p>локальная сеть, 10000 запросов, concurrency = 4: прирост в 25%</p></li>
<li><p>локальная сеть, 1000 запросов, concurrency = 1: в два раза!</p></li>
</ol>


<p>В боевых условиях, при наличии GPRS, 256k и прочего позора цивилизации, скорость ещё увеличится.</p>

<h3>Настройка веб-серверов</h3>

<p>В apache 1.3+ и nginx accept-фильтры поддерживаются.</p>

<p>Apache под FreeBSD изначально содержит такую конфигурацию:</p>

<pre><code> AcceptFilter http httpready
 AcceptFilter https dataready 
</code></pre>

<p>и менять её не стоит.
А вот в настройках сервера nginx стоит добавить опцию</p>

<pre><code>    accept_filter "httpready";
</code></pre>

<h3>Ссылки</h3>

<ul>
<li><p><a href="http://sysoev.ru/freebsd/accept-filters.html">статья Игоря Сысоева</a></p></li>
<li><p>man accf_http</p></li>
<li><p>man accf_data</p></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/31/unbelievable/">Невероятное рядом</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-31T19:51:57+03:00" pubdate data-updated="true">Oct 31<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Выхожу сегодня из метро, слушаю музыку. Мимо меня проходит ППС-ник, приставляет ладонь к виску та щось лопоче по-москальски.</p>

<p>Снимаю наушники:
&#8211; Здравствуйте, как вас зовут?
&#8211; Рядовой Глинкин. Можно ваши документы?
&#8211; Да, конечно (а сам начинаю придумывать, как же я буду без регистрации выкручиваться)
&#8211; А Вы не москвич. Нам нужен москвич в качестве понятого</p>

<p>И всё. И не доебался o_O.</p>

<p>В связи с этим два вопроса: с каких пор московская милиция начала расследовать преступления и почему они перешли на такой анахронизм как «понятые»?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/30/d0bed185-d183d0b6-d18dd182d0b0-d0bcd0bed181d0bad0b2d0b0/">ох уж эта Москва&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-30T02:19:23+03:00" pubdate data-updated="true">Oct 30<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ещё недавно мне казалось, что к Москве я привык. Я перестал обращать внимания на целующихся в метро парней, ирокезы, эмо, алкашей, попрошаек и прочих аттрибутов цивилизации Я с чистой совестью переступал через валяющегося под ногами панка</p>

<p>Но когда сегодня в 5 вечера в час пик я увидел девушку, которая справляет естественную нужду прям на станции метро &#8211; я понял, что к Москве я привыкну ещё не скоро.</p>

<p>А какие у вас были первые впечатления о Москве?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/27/d0bad0b8d182d0b0d0b9d186d18b-d0bcd0bed0bbd0bed0b4d186d18b/">Китайцы - молодцы</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-27T00:51:33+03:00" pubdate data-updated="true">Oct 27<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Смогли наебать хитрых московских провайдеров. Эти негодники прошаривают MAC-адреса свичей и блокируют их.
Но китайцы умные. Они спросили у меня:
&#8220;насяника, наса морда не пускають. мозна ми твоей морда представимся?&#8221;
Т.е. они могут копировать мой MAC-адрес для провайдера. TP-Link молодцы. Пока горжусь ими)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/20/verbs/">Да заебали уже!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-20T23:40:31+04:00" pubdate data-updated="true">Oct 20<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Если глагол отвечает на вопрос &#8220;что дела<strong>ть</strong>?&#8221;, &#8220;что сдела<strong>ть</strong>?&#8221; то в нём <strong>пишется</strong> мягкий знак.
Если глагол отвечает на вопрос &#8220;что дела<strong>ет</strong>? &#8220;что дела<strong>ют</strong>?&#8221; &#8220;что сдела<strong>ет</strong>?&#8221; то в нём <strong>не пишется</strong> мягкий знак.
Самое простое и тупое правило, это вам не сложноподчинённые приложения.
Проверочные слова: заебать, заебаться, заёбывает, заёбывается.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/20/dbixclass-v1/">DBIx::Class V1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-20T20:02:39+04:00" pubdate data-updated="true">Oct 20<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.slideshare.net/kostenko/dbix-class-2275572">DBIx Class</a></p>

<p>View more <a href="http://www.slideshare.net/">documents</a> from <a href="http://www.slideshare.net/kostenko">Андрiй Костенко</a>.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/15/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/13/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/17/dokazatiel%27stvo-togho/">Доказательство того</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/28/gdie-mienia-naiti/">Где меня найти</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/08/cached-urls-for-sass/">Cached URLs for sass</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/23/samolietostroitieli/">Самолетопоклонники</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/16/pochiemu-ia-nie-liubliu-iandieks/">Почему я не люблю Яндекс</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/gugu">@gugu</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'gugu',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("kostenko", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/kostenko" class="twitter-follow-button" data-show-count="false">Follow @kostenko</a>
  
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/108023428314804771773?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Andrii Kostenko -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'gugu';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
